<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <style>
        .action_button{
            height:10%;
            font-size:15pt;
            display: block;
            margin:20pt 20pt 20pt 20pt;
        }
        .btn_main_content{
            width:100%;
            height:80%;
            text-align-last: center;
            font-size:300pt;
            color:aliceblue;
            background: #00CCFF;
        }
        .timebar{
            background:#00CCFF;
            width:100%;
            height:10pt;
        }
        .tx_input {
            width:100pt;
            font-size:15pt;
            text-align-last:center;
        }
        label {
            font-size:20pt;
            height:100px;
        }
    </style>
    <script>
        var myInterval;
        var currentSecond=0;
        var greenMinutes=1;
        var yellowMinutes=1.5;
        var redMinutes=2;
        var threshholdMinutes=2.5;
        var speakerName="";
        var speechType="";
        function myTimer(){
            currentSecond++;
            var percentage=currentSecond/60/(document.getElementById("tx_threshhold_minute").value);
            percentage=(percentage>1)?1:percentage;
            document.getElementById("timebar").value=percentage;            
            document.getElementById("timebar").max=1;
            switch(currentSecond/60){
                case greenMinutes:
                    console.log("myTimer() greenMinutes="+greenMinutes);
                    document.getElementById("main-content").style.background="#00CC33";
                    break;
                case yellowMinutes:
                    console.log("myTimer() yellowMinutes="+yellowMinutes);
                    document.getElementById("main-content").style.background="#FFCC33";
                    break;
                case redMinutes:
                    console.log("myTimer() redMinutes="+redMinutes);
                    document.getElementById("main-content").style.background="#FF0033";
                    break;

            }
            if(currentSecond/60>threshholdMinutes&&currentSecond/60<threshholdMinutes+0.2){
                console.log("myTimer() threshholdMinutes="+threshholdMinutes);
                if(document.getElementById("main-content").style.background=="#FF0033")
                    document.getElementById("main-content").style.background="#FF0099";
                else
                    document.getElementById("main-content").style.background=="#FF0033";
            }
            var minutes=Math.floor(currentSecond/60);
            if(minutes==0) minutes="00";
                else if(minutes<10) minutes="0"+minutes;
            var remainSeconds=currentSecond%60;
            if(remainSeconds==0) remainSeconds="00";
            else if(remainSeconds<10) remainSeconds="0"+remainSeconds;
            
            document.getElementById("main-content").innerHTML=minutes+":"+remainSeconds;  
        }
        function startTimer(greenMinutes,yellowMinutes,redMinutes,speechType){
            speakerName=document.getElementById("speaker_name").value;
            console.log(speakerName);
            console.log(speechType);
            if(speakerName==""){
                alert("Please enter the speaker name!");
                return;
            }
            greenMinutes=greenMinutes;
            yellowMinutes=yellowMinutes;
            redMinutes=redMinutes;
            threshholdMinutes=redMinutes+0.5;
            speechType=speechType;
            document.getElementById("tx_green_minute").value=greenMinutes;
            document.getElementById("tx_yellow_minute").value=yellowMinutes;
            document.getElementById("tx_red_minute").value=redMinutes;
            document.getElementById("tx_threshhold_minute").value=redMinutes+0.5;
            document.getElementById("tx_speech_type").value=speechType;
            console.log("startTT() myInterval="+myInterval);
            currentSecond=0;
            document.getElementById("btns").style.display="none";
            myInterval=setInterval(myTimer,1000);
            document.getElementById("div_timer").style.display="block";
            document.getElementById("div_time_log").style.display="none";
            document.getElementById("div_time_rule").style.display="none";
            document.getElementById("h1_speaker").innerHTML=speechType+" "+speakerName+" is speaking...";
        }
        function pauseTimer(){
            console.log("pauseTimer() "+(new Date())+"myInterval="+myInterval);
            if(myInterval){
                clearInterval(myInterval);
                myInterval=null;
            }else
                myInterval=setInterval(myTimer,1000);
        }
        function stopTimer(){
            console.log("stopTimer() "+(new Date())+"myInterval="+myInterval);
            console.log("stopTimer() "+speechType);
            var newLog = document.createElement("LI");
            if(currentSecond/60>document.getElementById("tx_threshhold_minute").value)
                newLog.innerHTML="<font color=\"red\">";
            newLog.innerHTML+=document.getElementById("tx_speech_type").value+" "+speakerName+" : "+document.getElementById("tx_red_minute").value+"<->"+document.getElementById("main-content").innerHTML;
            if(currentSecond/60>document.getElementById("tx_threshhold_minute").value)
                newLog.innerHTML+="</font>";
            document.getElementById("ol_time_log").appendChild(newLog);
            currentSecond=0;
            document.getElementById("timebar").value=0;
            document.getElementById("main-content").innerHTML="00:00";
            clearInterval(myInterval);
            document.getElementById("btns").style.display="block";
            document.getElementById("div_time_log").style.display="none";
            document.getElementById("div_timer").style.display="none";
            document.getElementById("div_time_rule").style.display="block";
        }
        function startCustomizedTimer(){
            startTimer(document.getElementById("tx_green_minute").value,
                       document.getElementById("tx_yellow_minute").value,
                       document.getElementById("tx_red_minute").value,
                       document.getElementById("tx_speech_type").value
                      );
        }
        function showLogOnly(){
            document.getElementById("btns").style.display="none";
            document.getElementById("div_time_log").style.display="block";
            document.getElementById("div_time_rule").style.display="none";
        }
        function backToMain(){
            document.getElementById("btns").style.display="block";
            document.getElementById("div_time_log").style.display="none";
            document.getElementById("div_time_rule").style.display="block";
        }
        var data=[
            ["Table Topics",1,1.5,2,"TT"],
            ["Individual Evaluation",1.5,2.5,3,"IE"],
            ["General Evaluator",3,4,5,"GE"],
            ["Ice Breaker",4,5,6,"IB"],
            ["Prepared Speech",5,6,7,"PS"]
            ];
    </script>
</head>
<body style="width:99%">
    <div id="btns" style="font-size: 15pt;width:100%;float:left">
        <h2>
            <label>Speaker Name:</label><input type="text" id="speaker_name" holder="speaker name" class="tx_input"/>
            <label>Speech Type:</label><input type="text" id="tx_speech_type" class="tx_input"/>
        </h2>
        <script>
            for(var i=0;i<data.length;i++){
                document.write("<div style=\"float:left\">");
                document.write("<button onclick=\"startTimer("+data[i][1]+","+data[i][2]+","+data[i][3]+",'"+data[i][4]+"')\" class=\"action_button\">"+data[i][0]+"</button>");
                document.write("</div>");
            }
        </script>
        <div style="float:left">
            <button value="Customized Time Rule" onclick="startCustomizedTimer()" class="action_button" id="btn-ps">Customized Time Rule</button>
        </div>
    </div>
    <div style="float:left;margin-left: 20pt;" id="div_time_rule">
        <p>
        <label style="background: green"><font color="white"><input type="text" value="1" id="tx_green_minute" class="tx_input"/>分钟绿牌</font></label>，
        <label style="background: orange"><font color="white"><input type="text" value="2" id="tx_yellow_minute" class="tx_input"/>分钟黄牌</font></label>，
        <label style="background: red"><font color="white"><input type="text" value="3" id="tx_red_minute" class="tx_input"/>分钟红牌</font></label>，
        <label style="background: purple"><font color="white"><input type="text" value="3.5" id="tx_threshhold_minute" class="tx_input"/>分钟超时</font></label>
        </p>
        <button onclick="showLogOnly()" class="action_button">Time Log</button>
     </div>     
    <div id="div_timer" style="align-content:center;width:100%;display:none">
        <h1 id="h1_speaker" style="align-content:center;width:100%">Brad is speaking...</h1>
        <button onclick="pauseTimer()" ondblclick="stopTimer()" id="main-content" class="btn_main_content">00:00</button>
        <progress id="timebar" class="timebar" max="100" value="0"></progress>
    </div>
    <div id="div_time_log" style="align-content:center;width:100%;display:none">
        <button onclick="backToMain()" class="action_button">Back to Main</button>
        <h1>
        <script>
            document.write(new Date());
        </script>
        </h1>
        <ol id="ol_time_log"></ol>
    </div>
    </body>
</html>